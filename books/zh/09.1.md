## 9.1 如何跟踪工作流的运行

工作流跟踪是专为查看工作流执行情况而设计的功能。它提供一个跟踪基础结构，用于跟踪工作流实例的执行。WF跟踪基础结构透明地检测工作流，以发出反应对执行期间关键事件的记录。工作流实例开始或完成之后，会发出其处理跟踪记录。跟踪还可以提取与工作流变量关联的相关业务数据。例如如果工作流表示一个订单处理系统，则可以提取TrackingRecord对象以及订单ID。一般来讲，启用WF跟踪便于访问工作流执行的诊断数据或业务分析数据。

这些跟踪组件等效于WinFX中的跟踪服务。在.NET Framework 4.6.1中，WF跟踪功能的性能已改进，其编程模型也已简化。跟踪运行时会检测工作流实例以发出与工作流生命周期和工作流活动有关的事件以及自定义事件。

为了了解编程模型，介绍跟踪基础结构的主要组件。从工作流运行时发出的TrackingRecord对象（所有工作流跟踪记录均派生自其中的抽象类，跟踪记录表示在跟踪的事件发生时发送到跟踪参与者的数据），检测工作流运行时的目的是为了发出跟踪记录，以便跟踪工作流实例的执行。

TrackingParticipant对象订阅TrackingRecord对象。跟踪参与者包含用于处理TrackingRecord对象中负载的逻辑（例如，它们可以选择向某个文件写入）。TrackingProfile对象筛选从工作流实例发出的跟踪记录。

工作流跟踪基础结构遵循一个范例，即发布和订阅范例。工作流实例是跟踪记录的发布者，而跟踪记录的订阅者注册为工作流的扩展。订阅TrackingRecord对象的这些扩展称为跟踪参与者。跟踪参与者是一些扩展点，这些扩展点按照编写的目的来访问TrackingRecord对象和处理对象。跟踪基础结构允许对传出跟踪记录应用筛选器，以便参与者可订阅该记录的子集。此筛选机制是通过跟踪配置文件来实现的。

## links
   * [目录](<preface.md>)
   * 上一节: [活动组件库的Nupkg包的管理](<08.7.md>)
   * 下一节: [新建跟踪参与者示例项目](<09.2.md>)